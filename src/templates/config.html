{% extends 'base.html' %}

{% block title %}Configuration - Job Agent{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 offset-md-1">
        <h1 class="mb-4">Configuration</h1>

        <!-- Standard Questions -->
        <div class="card mb-4">
            <div class="card-header">Standard Application Questions</div>
            <div class="card-body">
                <p>Define your answers to common questions asked during applications. The agent will use these when it encounters a matching question (exact or similar wording).</p>
                <form action="{{ url_for('update_config') }}" method="post">
                    <div id="standard-questions-list">
                        <!-- Questions will be loaded/added here dynamically -->
                        {% for qa in standard_answers %}
                        <div class="row mb-3 standard-question-item">
                            <div class="col-md-5">
                                <label class="form-label">Question</label>
                                <input type="text" class="form-control" name="question_{{ loop.index0 }}" value="{{ qa.question }}" placeholder="e.g., Are you legally authorized to work...?">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Answer</label>
                                <textarea class="form-control" name="answer_{{ loop.index0 }}" rows="2" placeholder="e.g., Yes">{{ qa.answer }}</textarea>
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="button" class="btn btn-danger btn-sm remove-question">Remove</button>
                            </div>
                        </div>
                        {% else %}
                        <p>No standard questions defined yet. Add some below.</p>
                        {% endfor %}
                    </div>

                    <button type="button" id="add-question" class="btn btn-secondary mb-3">Add Question</button>
                    <br>
                    <button type="submit" class="btn btn-primary">Save Configuration</button>
                </form>
            </div>
        </div>

        <!-- Other Configurations (Placeholder) -->
        <div class="card">
            <div class="card-header">Other Settings</div>
            <div class="card-body">
                <form>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="autoAttachCoverLetter" name="auto_attach_cover_letter" {% if config.auto_attach_cover_letter %}checked{% endif %}>
                        <label class="form-check-label" for="autoAttachCoverLetter">Automatically attach generated cover letter (if available)</label>
                        <div class="form-text">If unchecked, the cover letter will be generated but not attached automatically.</div>
                    </div>
                    <!-- Add more settings as needed -->
                    <button type="submit" class="btn btn-primary" disabled>Save Settings (Not Implemented)</button>
                </form>
            </div>
        </div>

    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('add-question').addEventListener('click', function() {
    const list = document.getElementById('standard-questions-list');
    const index = list.querySelectorAll('.standard-question-item').length;
    const newItem = document.createElement('div');
    newItem.classList.add('row', 'mb-3', 'standard-question-item');
    newItem.innerHTML = `
        <div class="col-md-5">
            <label class="form-label">Question</label>
            <input type="text" class="form-control" name="question_${index}" placeholder="e.g., Are you legally authorized to work...?">
        </div>
        <div class="col-md-6">
            <label class="form-label">Answer</label>
            <textarea class="form-control" name="answer_${index}" rows="2" placeholder="e.g., Yes"></textarea>
        </div>
        <div class="col-md-1 d-flex align-items-end">
            <button type="button" class="btn btn-danger btn-sm remove-question">Remove</button>
        </div>
    `;
    list.appendChild(newItem);
    attachRemoveListeners();
});

function attachRemoveListeners() {
    document.querySelectorAll('.remove-question').forEach(button => {
        button.removeEventListener('click', handleRemoveClick); // Prevent duplicate listeners
        button.addEventListener('click', handleRemoveClick);
    });
}

function handleRemoveClick(event) {
    event.target.closest('.standard-question-item').remove();
    // Re-index remaining items if necessary for form submission logic
    const items = document.querySelectorAll('.standard-question-item');
    items.forEach((item, index) => {
        item.querySelector('input[name^="question_"]').name = `question_${index}`;
        item.querySelector('textarea[name^="answer_"]').name = `answer_${index}`;
    });
}

// Initial attachment of listeners on page load
attachRemoveListeners();
</script>
{% endblock %}
